(function(e){e.fn.columnize=function(a){var q={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,manualBreaks:!1,cssClassPrefix:""};a=e.extend(q,a);"string"==typeof a.width&&(a.width=parseInt(a.width,10),isNaN(a.width)&&(a.width=q.width));return this.each(function(){function d(a,b){var d=b?".":"";return r.length?d+r+"-"+a:d+a}function A(b,p,n,h){for(;(B||n.height()<h)&&p[0].childNodes.length;){var c=
p[0].childNodes[0];if(e(c).find(d("columnbreak",!0)).length||e(c).hasClass(d("columnbreak")))return;b.append(c)}if(0!==b[0].childNodes.length){c=b[0].childNodes;c=c[c.length-1];b[0].removeChild(c);c=e(c);if(3==c[0].nodeType){var g=c[0].nodeValue,j=a.width/18;a.accuracy&&(j=a.accuracy);var m;for(m=null;n.height()<h&&g.length;){var f=g.indexOf(" ",j);m=-1!=f?g.substring(0,g.indexOf(" ",j)):g;m=document.createTextNode(m);b.append(m);g=g.length>j&&-1!=f?g.substring(f):""}n.height()>=h&&null!==m&&(b[0].removeChild(m),
g=m.nodeValue+g);if(g.length)c[0].nodeValue=g;else return!1}p.contents().length?p.prepend(c):p.append(c);return 3==c[0].nodeType}}function C(b,a,e,h){if(!b.contents(":last").find(d("columnbreak",!0)).length&&(!b.contents(":last").hasClass(d("columnbreak"))&&a.contents().length)&&(a=a.contents(":first"),1==a.get(0).nodeType)){var c=a.clone(!0);a.hasClass(d("columnbreak"))?(b.append(c),a.remove()):B?(b.append(c),a.remove()):1==c.get(0).nodeType&&!c.hasClass(d("dontend"))&&(b.append(c),c.is("img")&&
e.height()<h+20?a.remove():!a.hasClass(d("dontsplit"))&&e.height()<h+20?a.remove():c.is("img")||a.hasClass(d("dontsplit"))?c.remove():(c.empty(),A(c,a,e,h)?a.addClass(d("split")):(a.addClass(d("split")),a.children().length&&C(c,a,e,h)),0===c.get(0).childNodes.length&&c.remove()))}}function x(a){return 3==a.nodeType?/^\s+$/.test(a.nodeValue)?!a.previousSibling?!1:x(a.previousSibling):!1:1!=a.nodeType?!1:e(a).hasClass(d("dontend"))?!0:0===a.childNodes.length?!1:x(a.childNodes[a.childNodes.length-1])}
function v(){if(E!=b.width()){E=b.width();var k=Math.round(b.width()/a.width),p=a.width,n=a.height;a.columns&&(k=a.columns);B&&(k=s.find(d("columnbreak",!0)).length+1,p=!1);if(1>=k){if(!(b.data("columnized")&&1==b.children().length)){b.data("columnized",!0);b.data("columnizing",!0);b.empty();b.append(e("<div class='"+d("first")+" "+d("last")+" "+d("column")+" ' style='width:100%; float: "+a.columnFloat+";'></div>"));$col=b.children().eq(b.children().length-1);$destroyable=s.clone(!0);if(a.overflow){targetHeight=
a.overflow.height;A($col,$destroyable,$col,targetHeight);for($destroyable.contents().find(":first-child").hasClass(d("dontend"))||C($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&x($col.contents(":last").get(0));)k=$col.contents(":last"),k.remove(),$destroyable.prepend(k);for(var k="",h=document.createElement("DIV");0<$destroyable[0].childNodes.length;){var c=$destroyable[0].childNodes[0];if(c.attributes)for(var g=0;g<c.attributes.length;g++)0===c.attributes[g].nodeName.indexOf("jQuery")&&
c.removeAttribute(c.attributes[g].nodeName);h.innerHTML="";h.appendChild($destroyable[0].childNodes[0]);k+=h.innerHTML}e(a.overflow.id)[0].innerHTML=k}else $col.append($destroyable);b.data("columnizing",!1);a.overflow&&a.overflow.doneFunc&&a.overflow.doneFunc()}}else if(!b.data("columnizing")){b.data("columnized",!0);b.data("columnizing",!0);b.empty();b.append(e("<div style='width:"+Math.floor(100/k)+"%; float: "+a.columnFloat+";'></div>"));f=b.children(":last");f.append(s.clone());F=f.height();b.empty();
h=F/k;c=3;g=!1;a.overflow?(c=1,h=a.overflow.height):n&&p&&(c=1,h=n,g=!0);for(n=0;n<c&&20>n;n++){b.empty();var j,m,f,t;try{j=s.clone(!0)}catch(w){j=s.clone()}j.css("visibility","hidden");for(var l=0;l<k;l++)m=0===l?d("first"):"",m+=" "+d("column"),m=l==k-1?d("last")+" "+m:m,b.append(e("<div class='"+m+"' style='width:"+Math.floor(100/k)+"%; float: "+a.columnFloat+";'></div>"));for(l=0;l<k-(a.overflow?0:1)||g&&j.contents().length;){b.children().length<=l&&b.append(e("<div class='"+m+"' style='width:"+
Math.floor(100/k)+"%; float: "+a.columnFloat+";'></div>"));f=b.children().eq(l);g&&f.width(p+"px");A(f,j,f,h);for(C(f,j,f,h);f.contents(":last").length&&x(f.contents(":last").get(0));)t=f.contents(":last"),t.remove(),j.prepend(t);l++;0===f.contents().length&&j.contents().length?f.append(j.contents(":first")):l==k-(a.overflow?0:1)&&!a.overflow&&j.find(d("columnbreak",!0)).length&&k++}if(a.overflow&&!g)if(document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.")){t="";for(var q=document.createElement("DIV");0<
j[0].childNodes.length;){for(var y=j[0].childNodes[0],l=0;l<y.attributes.length;l++)0===y.attributes[l].nodeName.indexOf("jQuery")&&y.removeAttribute(y.attributes[l].nodeName);q.innerHTML="";q.appendChild(j[0].childNodes[0]);t+=q.innerHTML}e(a.overflow.id)[0].innerHTML=t}else e(a.overflow.id).empty().append(j.contents().clone(!0));else if(g)b.children().each(function(a){f=b.children().eq(a);f.width(p+"px");0===a?f.addClass(d("first")):a==b.children().length-1?f.addClass(d("last")):(f.removeClass(d("first")),
f.removeClass(d("last")))}),b.width(b.children().length*p+"px");else{f=b.children().eq(b.children().length-1);j.contents().each(function(){f.append(e(this))});f.height();var z=0,r=1E7,u=0,D=!1,v=0;b.children().each(function(a){return function(b){b=a.children().eq(b);b.children(":last").find(d("columnbreak",!0)).length||(b=b.height(),D=!1,z+=b,b>u&&(u=b,D=!0),b<r&&(r=b),v++)}}(b));l=z/v;0===z?n=c:a.lastNeverTallest&&D?(h+=30,n==c-1&&c++):30<u-r?h=l+30:20<Math.abs(l-h)?h=l:n=c}b.append(e("<br style='clear:both;'>"))}b.find(d("column",
!0)).find(":first"+d("removeiffirst",!0)).remove();b.find(d("column",!0)).find(":last"+d("removeiflast",!0)).remove();b.data("columnizing",!1);a.overflow&&a.overflow.doneFunc();a.doneFunc()}}}var b=a.target?e(a.target):e(this),F=e(this).height(),s=e("<div></div>"),E=0,B=a.manualBreaks,r=q.cssClassPrefix;"string"==typeof a.cssClassPrefix&&(r=a.cssClassPrefix);s.append(e(this).contents().clone(!0));if(!a.ignoreImageLoading&&!a.target&&!b.data("imageLoaded")&&(b.data("imageLoaded",!0),0<e(this).find("img").length)){var u,
w=e(this),G=s;u=function(){w.data("firstImageLoaded")||(w.data("firstImageLoaded","true"),w.empty().append(G.children().clone(!0)),w.columnize(a))};e(this).find("img").one("load",u);e(this).find("img").one("abort",u);return}b.empty();v();a.buildOnce||e(window).resize(function(){a.buildOnce||(b.data("timeout")&&clearTimeout(b.data("timeout")),b.data("timeout",setTimeout(v,200)))})})}})(jQuery);
